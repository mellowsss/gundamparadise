generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id              String           @id @default(cuid())
  email           String?          @unique
  name            String?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  collectionItems CollectionItem[]
  priceAlerts     PriceAlert[]
  wishlistItems   WishlistItem[]
}

model Kit {
  id              String           @id @default(cuid())
  name            String
  grade           String
  series          String?
  scale           String?
  releaseDate     DateTime?
  imageUrl        String?
  description     String?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  collectionItems CollectionItem[]
  priceAlerts     PriceAlert[]
  priceEntries    PriceEntry[]
  storeLinks      StoreLink[]
  wishlistItems   WishlistItem[]

  @@index([grade])
  @@index([name])
}

model Store {
  id         String      @id @default(cuid())
  name       String      @unique
  website    String
  logoUrl    String?
  createdAt  DateTime    @default(now())
  storeLinks StoreLink[]
}

model StoreLink {
  id        String   @id @default(cuid())
  kitId     String
  storeId   String
  url       String
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  kit       Kit      @relation(fields: [kitId], references: [id], onDelete: Cascade)
  store     Store    @relation(fields: [storeId], references: [id], onDelete: Cascade)

  @@unique([kitId, storeId])
  @@index([kitId])
}

model PriceEntry {
  id         String   @id @default(cuid())
  kitId      String
  storeId    String?
  price      Float
  currency   String   @default("USD")
  inStock    Boolean  @default(true)
  recordedAt DateTime @default(now())
  kit        Kit      @relation(fields: [kitId], references: [id], onDelete: Cascade)

  @@index([kitId])
  @@index([recordedAt])
}

model WishlistItem {
  id          String   @id @default(cuid())
  userId      String
  kitId       String
  targetPrice Float?
  notes       String?
  addedAt     DateTime @default(now())
  kit         Kit      @relation(fields: [kitId], references: [id], onDelete: Cascade)
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, kitId])
  @@index([userId])
}

model CollectionItem {
  id            String    @id @default(cuid())
  userId        String
  kitId         String
  purchasePrice Float?
  purchaseDate  DateTime?
  notes         String?
  addedAt       DateTime  @default(now())
  kit           Kit       @relation(fields: [kitId], references: [id], onDelete: Cascade)
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, kitId])
  @@index([userId])
}

model PriceAlert {
  id          String    @id @default(cuid())
  userId      String
  kitId       String
  targetPrice Float?
  alertType   String
  isActive    Boolean   @default(true)
  createdAt   DateTime  @default(now())
  triggeredAt DateTime?
  kit         Kit       @relation(fields: [kitId], references: [id], onDelete: Cascade)
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([kitId])
  @@index([isActive])
}
